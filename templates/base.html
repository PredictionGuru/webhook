<!DOCTYPE HTML>
<html>
  <head>
    <title>Webhook - Start</title>
    <style>
      #content {
        width: 500px;
        border: 3px solid #ddd;
        margin: auto;
        padding: 25px 50px;
      }
      #content div {
        margin: 15px;
      }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
    </script>
  </head>
  <body>
    <div id="content">
      <h1>Webhook Management</h1>
      <h2>Created:</h2>
      {{template "content" .}}
      <h2>Create new:</h2>
      <form method="post" action="/save" accept-charset="UTF-8">
        <div>Handler: <input name="handler" /></div>
        {{with .AccessToken}}
          <div>Board: <select name="boards" id="boards"></select></div>
          <div>List: <select name="lists" id="lists"></select></div>
          <div>
            <input type="submit" value="Save" />
          </div>
        {{else}}
          <a href="/connect">Connect to Trello</a>
        {{end}}
      </form>
    </div>
    {{with .AccessToken}}
      <script>
        $(document).ready(function () {
          $.ajax({
            method: "POST",
            url: "/trello/boards/list"
          }).done(function(data) {
            $('#boards').html('');
            $.each(data, function (index) {
              var temp = data[index];
              $('#boards').append(
                  '<option value="' + temp.id + '">' + temp.name + '</option>');
            });
          });

          // on change of board
          $('#boards').on('change', function () {
            var value = $(this).val();
            $.ajax({
              method: 'POST',
              url: '/trello/lists/' + value
            }).done(function (data) {
              $('#lists').html('');
              $.each(data, function (index) {
                var temp = data[index];
                $('#lists').append(
                    '<option value="' + temp.id + '">' + temp.name + '</option>');
              });
            })
          });
        });
      </script>
    {{end}}
  </body>
</html>
